<% content_for(:title_tag) do %>
  <%= @space.title %> | skill4.space: Match your skills with a space that needs it
<% end %>

<div class="slider-for">
  <% @space.photos.each do |photo| %>
    <div class="space-show-banner" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.2)), url('<%= cl_image_path photo.path %>');"></div>
  <% end %>
</div>

<div class="container">
  <div class="slider-nav">
    <% @space.photos.each do |photo| %>
      <div>
        <div class="space-show-banner" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.2)), url('<%= cl_image_path photo.path, width: 300, height: 200, crop: :fill %>');"></div>
      </div>
    <% end %>
  </div>
</div>
<div class="space-show-container">
  <div class="container">
    <div class="row">
      <div class="col-xs-12 col-sm-8">
          <h1><%= @space.title %></h1>
          <p>-<%= @space.category %> Opportunity at <%= @space.name %> </p>
          <p><i class="fa fa-map-marker"></i> <%= @space.address %></p>
          <p><%= @space.description %></p>
          <h2>Desired Skills</h2>
          <p><i class="fa fa-key"></i> <%= @space.required_skill %> Skill</p>
          <p>(Required skill description here)<%#= @space.required_skill_description %></p>
          <h2>Space Details</h2>
          <p><i class="fa fa-wrench"></i> Facilities: <%= @space.facility %></p>
          <p><i class="fa fa-users"></i> Maximum Capacity: <%= @space.people_capacity %></p>
          <p><i class="fa fa-building-o"></i> Floor Area: <%= @space.floor_area %></p>
          <p><i class="fa fa-clock-o"></i> Opening & Closing Hours: <%= @space.opening_hours %> ã€œ <%= @space.closing_hours %></p>
          <br>
          <h2>Reviews on the owner</h2>
          <div class="row">
            <% @space.user.user_reviews.each do |review| %>
              <div class="profile-review">
                <div class="review-left">
                  <% if User.find_by(name: review.reviewer_name).photo.present? %>
                    <%= cl_image_tag User.find_by(name: review.reviewer_name).photo.path, class: "profile-avatar reviewer-avatar" %>
                  <% else %>
                    <%= image_tag "person-placeholder.jpg", class: "profile-avatar reviewer-avatar" %>
                  <% end %>
                  <p><%= review.reviewer_name %></p>
                  <div class="stars">
                    <ul>
                      <% review.rating.to_i.times do  %>
                        <li><i class="fa fa-star starred"></i></li>
                      <% end %>
                      <% (5 - review.rating.to_i).times do  %>
                        <li><i class="fa fa-star"></i></li>
                      <% end %>
                    </ul>
                  </div>
                </div>
                <div class="review-right">
                  <h4><%= review.title %></h4>
                  <p><%= review.content %></p>
                </div>
              </div>
            <% end %>
          </div>
          <br>
      </div>
      <div class="col-xs-12 col-sm-4">
        <div class="right-pain text-center">
          <h2>Book this place</h2>
          <hr>
          <h3>Select Dates</h3>
          <div class="book-form">
            <%= form_tag(conversations_path, method: :post) do %>
            <%#= form_tag(conversations_path, method: :post, 'data-id': @space.id) do %>
              <%#= text_field_tag :species, params[:species] %>
              <label class="control-label optional" for="book_start_date">FROM:</label>
              <%= date_field_tag :start_date, params[:start_date], value: @space.start_date, id: "book-start-date" %>
              <br>
              <label class="control-label optional" for="book_end_date">TO:</label>
              <%= date_field_tag :end_date, params[:end_date], class: "form-top", value: @space.end_date, id: "book-end-date" %>
              <%= hidden_field_tag "space_id", @space.id%>
              <p></p>
              <%= submit_tag "Book", class: "btn btn-success" %>
              <%#= submit_tag 'PAY WITH SKILLS', name: nil, disabled: true, class: "btn btn-success btn-lg", id: "booking-button" %>
              <!-- <h5>OR</h5> -->
              <%#= submit_tag 'PAY WITH CASH', disabled: true, class: "btn btn-success btn-lg", id: "booking-cash-button" %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="map"></div>

<% content_for(:after_js) do %>
  <%= javascript_tag do %>
    $(document).ready(function() {
      var handler = Gmaps.build('Google');
      handler.buildMap({ internal: { id: 'map' } }, function() {
        markers = handler.addMarkers(<%= raw @hash.to_json %>);
        handler.bounds.extendWith(markers);
        handler.fitMapToBounds();
        if (markers.length == 0) {
          handler.getMap().setZoom(2);
        } else if (markers.length == 1) {
          handler.getMap().setZoom(14);
        }
      });
    });
  <% end %>
<% end %>

